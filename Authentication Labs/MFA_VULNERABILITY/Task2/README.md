# MFA Lab 2 — Brute-Forcing MFA When You Can’t Bypass It
## WebSecurity 101 · Authentication · MFA Vulnerabilities

This lab demonstrates a real-world MFA failure mode where the second factor is implemented correctly, yet remains exploitable due to missing enforcement controls.
- In MFA Lab 1, MFA could be bypassed entirely due to broken logic.
- In MFA Lab 2, bypass is no longer possible — but brute force is.
--------------------
## Learning Objective

This lab teaches a critical lesson in authentication security:
- Correct verification logic is not enough.
- MFA verification is a high-risk boundary and must be protected with enforcement controls such as rate limiting, expiration, and lockouts.
---------------------------
## Threat Model Summary
| Component               | Status               |
| ----------------------- | -------------------- |
| Password authentication | ✅ Rate-limited       |
| OTP generation          | ✅ Random 4-digit OTP |
| OTP validation          | ✅ Correct            |
| OTP bound to session    | ✅ Yes                |
| OTP expiration          | ❌ No                 |
| OTP attempt limit       | ❌ No                 |
| Session expiration      | ❌ No                 |
- The result is a persistent MFA attack surface.
-------------------------------
## Lab Architecture Overview

### Authentication Flow :

1. User logs in with username + password
2. Server generates a 4-digit OTP
3. OTP is emailed to the user
4. OTP is stored server-side and bound to sessionId
5. User must verify OTP to access protected resource

### Security Assumption (Flawed)
``OTP entropy alone is sufficient protection.``
- This assumption is false.
-----------------------------------
## Project Structure
``ts
├── db.js                     # MongoDB connection & schemas
├── routes/
│   ├── task2.js              # Login + OTP generation
│   ├── verify-otp.js         # OTP verification (vulnerable)
│   └── protected-resource.js # Protected endpoint
├── utils/
│   └── sendOtpEmail.js       # OTP email delivery
├── server.js
└── README.md``

--------------------------------------------
## Lab Setup

### Installation
``ts
git clone https://github.com/cybersagnik/WebSecurityLabs/new/main/Authentication%20Labs/MFA_VULNERABILITY/Task2
cd Task2
npm install``

### Start mongodb and server
``ts
mongod
node index.js``

- On shutdown (Ctrl + C), the database is wiped automatically for a clean lab reset.
-------------------------------------------------
## Test Users
- Users are auto-seeded on startup
| Username | Password          | Description                    |
| -------- | ----------------- | ------------------------------ |
| john     | `john_otp123`     | Intended brute-force target    |
| carlos   | `carlos_bypassme` | Higher-value protected account |

``Email addresses can be updated in the database to point to a test inbox and smtp should be configured in /utils/sendOtpEmail.js``

--------------------------------------------------



